#include "gtest/gtest.h"

#include "file.h"
#include "test/Person.h"
#include <stdio.h>
#include <unistd.h>
#include <sys/stat.h>
#include <sys/types.h>

namespace TC=ThorsAnvil::FileSystem::ColumnFormat;

// The fixture for testing class Foo.
class OpenPersonTest: public ::testing::Test
{
    protected:
        void TearDown() override
        {
            remove("TestData/name");
            remove("TestData/age");
            remove("TestData");
        }
};

class OpenPersonTestFail: public ::testing::Test
{
    protected:
        void SetUp() override
        {
            mkdir("LockedData", 0);
        }
        void TearDown() override
        {
            remove("LockedData");
        }
};


TEST(OpenNoFile, Constructor)
{
    // Just construct and destruct
    TC::File<Person>    file;
}

TEST_F(OpenPersonTest, ConstructorWithName)
{
    // Just construct and destruct
    TC::File<Person>    file("TestData");

    ASSERT_NE(access("TestData/name", R_OK | W_OK), -1);
    ASSERT_NE(access("TestData/age", R_OK | W_OK), -1);
    ASSERT_NE(access("TestData", R_OK | W_OK | X_OK), -1);
    ASSERT_TRUE(file);
}

TEST_F(OpenPersonTestFail, ConstructorWithName)
{
    TC::File<Person>    file("LockedData");
    ASSERT_FALSE(file);
}

